# Chapter12. 고급 그래프 알고리즘
고-오급 알고리즘을 살펴보자.  

## 12.1 그래프의 강 결합성
방향 그래프의 모든 노드에서 다른 모든 노드로 가는 경로가 있는 경우에는 **강 결합 그래프**라고 부른다.  
즉, 어떤 노드 x에서 어떤 노드 y로 가는 경로가 무조건 존재하는 경우이다.  
**강 결합 그래프**보다 하위 개념인 **강 결합 컴포넌트** 는 모든 방향 그래프에 존재하는데, 그래프 전체가 아니라 일부분에 강 결합 그래프가 보이면 강 결합 컴포넌트라고 부른다.  
> 강 결합 컴포넌트는 1개의 노드만 가지고 있을 수도 있다.  

### 12.1.1 코사라주 알고리즘
그래프에서 강 결합 컴포넌트를 찾는 방법이다.  
우선 두 번의 DFS를 진행하는데 첫 번째 탐색에서는 그래프의 구조에 따라 노드 리스트 생성, 두 번째 탐색에서는 강 결합 컴포넌트를 구한다.  
두 번째 탐색에서는 원본 방향 그래프의 간선 방향을 역으로 배치한다. 이 후, 생성된 노드 리스트의 가장 끝 부분부터 그래프 탐색을 하면서 노드 리스트에서 제거한다.  
이 때, 그래프 탐색 중, 노드 리스트에 없다면 하나의 강 결합 컴포넌트가 생성된 것으로 간주한다.  

### 12.1.2 2-SAT 문제
![논리식](https://blogfiles.pstatic.net/20160902_151/kks227_1472760030282Yhuqa_PNG/%C1%A6%B8%F1_%BE%F8%C0%BD.png?type=w3)
위 식을 가지고 푸는 문제이다.  
식을 간단히 보자면 해당 식이 true가 되려면 `x1=x2=false, x3=true`가 되면 충족한다.  

![논리식](https://blogfiles.pstatic.net/20160902_191/kks227_1472760132952se6a4_PNG/2.png?type=w3)
하지만 이 식은 어떤 값을 넣더라도 true를 만들 수가 없다.  

그렇다면 왜 이게 그래프 이론에서 나오느냐?  
간단하게 말하자면 `x1 => not x1 이면서 not x1 => x1일 수 없다.` 라는 모순을 그래프에서 찾을 수 있기 때문이다.  
다시 말해서 강 결합 그래프 혹은 강 결합 컴포넌트에 있는 노드 집합들 중에서는 x(i)와 not x(i)가 공존 할 수 없다는 이야기이다.  
즉, 논리식을 잘 짜놓고 방향 그래프를 그린다면 이 논리식에 해답이 존재하는지, 존재하지 않은지 확인할 수 있다.  

이 2-sat문제는 두 개의 선택지가 있고 둘 중 최소한 하나는 만족해야한다는 조건이 있는 문제에서 활용이 가능하다.  
> 사실 문제에서 2-SAT을 사용해야한다고 생각도 못할 것 같다.  

## 12.2 완전 경로
개념  
1. 오일러 경로 : 모든 간선을 정확히 한 번씩 지나가는 경로  
2. 해밀턴 경로 : 모든 노드를 정확히 한 번씩 방문하는 경로  
유사한 개념이지만 조금만 생각하면 두 경로는 명확하게 다르다는 것을 알 수 있을 것이다.  

### 12.2.1 오일러 경로
그래프에 존재하는 모든 간선을 한 번씩만 지나가는 경로이다. 이 때, 시작과 끝 지점이 동일한 노드라면 **오일러 회로(Eulerain circuit)**라고 한다.  
오일러 경로와 회로가 존재하는지는 노드의 차수에 따라 결정되는데 아래의 제약 조건을 만족하면 된다.  
- 모든 간선이 같은 연결 컴포넌트에 속하고
1. 모든 노드의 차수가 짝수이거나 --> 오일러 경로는 오일러 회로가 된다.  
2. 정확히 두 노드의 차수가 홀수이고, 다른 모든 노드의 차수는 짝수이다. --> 차수가 홀수인 노드가 양 끝 점이 되는 오일러 경로이다.  

위의 경우에는 무방향 그래프일 경우에 사용이 가능하고, 방향성이 있는 그래프에는 노드의 진입 차수와 진출 차수를 확인하면 된다. 
- 모든 간선이 같은 강 결합 컴포넌트에 속하고  
1. 모든 노드의 진입 차수와 진출 차수가 같거나 --> 오일러 경로는 오일러 회로가 된다.  
2. 한 노드의 진입 차수가 진출 차수보다 1크고, 다른 한 노드의 진출 차수가 진입 차수보다 1크며, 나머지 노드는 진입 차수와 진출 차수가 같다. --> 진출 차수가 큰 노드에서 시작해서 진입 차수가 큰 노드에서 끝나는 오일러 경로를 이룬다.  

#### 경로 찾기
히어홀처 알고리즘은 오일러 회로를 찾는 효율적인 알고리즘이다.  
이 알고리즘은 오일러 회로가 존재한다는 가정을 가지고 진행하는 알고리즘으로, 만약 오일러 회로가 없는 그래프에 적용하면 답을 찾지 못한다.  

먼저, 노드 하나를 지닌 회로에서 진행을 한다. 
회로에 있는 노드 중 회로에 포함되지 않은 진출 간선이 있는 노드에 대해서 부분 회로를 찾는다.  
찾았다면 해당 부분회로를 원래 회로에 병합시킨다.  
> 말이 쉽지, 어떻게 첫 노드를 선정하고, 해당 노드에서부터 자기 자신으로 들어오는 경로를 어떻게 찾아야하는지도.. 

### 12.2.2 해밀턴 경로
그래프의 모든 노드를 정확히 한 번씩만 방문하는 경로이다.  
시작 노드와 끝 노드가 같은 경우에는  **해밀턴 회로(Hamiltonian Circuit)**라고 한다.  
해밀턴 경로와 관련된 문제는 NP-하드로 일반적인 방법은 알려지지 않았다.  
특정한 경우에는 해밀턴 경로가 있음을 보장하긴한다.  
> 완전 그래프에는 해밀턴 경로가 존재한다.  

해밀턴 경로를 찾는 가장 간단한 방법은 퇴각 검색을 이용하여 경로를 구성하는 것이다. 
이 경우에는 모든 경우를 찾아야하기 때문에 `O(n!)`의 시간이 걸리지만 동적 계획법을 사용한다면 `O((2^n)*(n^2))`시간에 찾을 수도 있다.  
> 에잉 몰라.

### 12.2.3 응용
#### 드 브루인 수열(De Bruijn sequence)
문자열의 일종으로, 글자의 종류가 k개일 때 만들 수 있는 길이가 n인 모든 문자열을 정확히 한 번씩 포함하는 수열이다.  
즉, 문자열이 있으면 해당 문자열 안에 k개의 글자로 길이가 n인 문자열을 모두 찾을 수 있는 것이다.  
길이는 k^n+n-1이 되며, 오일러 경로로 수열을 찾을 수 있다.  
> 복잡하다.  

#### 나이트 투어
n*n 체스판에서 나이트가 체스판의 모든 칸을 정확히 한 번씩 방문하는 경로이다.  
이 때, 원래 위치로 돌아온다면 닫힌 나이트 투어, 그렇지 않으면 열린 나이트 투어라고 한다.  

체스판의 각 칸이 노드가 되고, 이동할 수 있는 경로를 간선으로 연결한 그래프라 생각을 했을 경우, 해밀턴 경로와 대응이 된다.  
다만 탐색이 퇴각 검색을 이용해야하므로 시간이 오래걸린다.  

다른 알고리즘으로 바른스도로프 규칙이 있는데, 나이트가 움직일 수 있는 여러 칸 중, 옮겨진 칸에서 이동할 수 있는 경우가 가장 작은 곳으로 이동하는 것이다.  
> 신기하군. 나중에 풀어봐야겠다.  

## 12.3 최대 유량
최대 유량 문제는 소스와 싱크라는 특별한 노드 두 개를 가진 그래프를 다루는 문제이다.  
소스는 나가는 간선만 존재하고 싱크는 들어오는 간선만 존재한다.  
이 문제의 목표는 싱크로 들어가는 유량을 최대하는 것으로 만드는 것으로, 각 간선에는 흐를 수 있는 최대 유량이 정해져있다.  
한 노드에서 다른 노드들로 나가는 유량의 합은 들어온 유량의 합과 같아야한다.  
> 그럼 시작 유량은 누가 정해주지? 그냥 백트래킹으로 검색?  

최대 유량 문제의 다른 유형은 최소 컷 문제이다.  
최소 컷 문제는 간선 중 일부를 제거하여 싱크로 가는 경로를 없애면서, 간선의 가중치 합이 최소가 되게 끔 하는 문제이다.  

### 12.3.1 포드-풀커슨 알고리즘
포드-풀커슨 알고리즘(Ford-Fulkerson algorithm)은 그래프의 최대 유량을 찾아주는 알고리즘이다.  
처음에는 유량이 0인 상태로 시작하며, 각 단계마다 소스에서 싱크로 가는 경로 중, 유량을 늘릴 수 있는 경로를 찾는다.  
이 알고리즘에서는 간선마다 반대 방향의 간선도 추가한 특이한 방향 그래프를 사용하는데 각 간선의 가중치는 얼마나 유량을 늘릴 수 있는가를 나타낸다.  
원래 간선과 반대로 그린 간선은 가중치를 0으로 표현한다.  

각 라운드마다 소스에서 싱크로 가는 경로 중, 모든 간선의 가중치가 양수인 경로를 찾는다.  
만약 그 경로가 여러 개라면 무작위로 하나를 선택하면 된다.  
선택된 경로에 포함된 간선의 가중치 최소 값이 x라면 x만큼 유량을 증가시킬 수 있다.  
이를 위해서 경로 상 각 간선에 대해 x만큼 가중치를 감소시키고, 반배 방향 간선의 가중치를 x만큼 증가 시킨다.  
소스에서 가중치가 양수인 간선을 통해서 싱크로 가는 경로가 없다면 최대 유량이 존재하는 것으로 알고리즘을 종료시킨다.
추가된 간선에서 최대 값이 최대 유량이 된다.  


**아이디어**
아이디어는 간선의 유량이 증가하면 앞으로 추가할 수 있는 유량은 감소한다. 라는 논리를 가지고 나온 것이다.  
라운드를 진행하면서 다른 경로를 택하는 것이 더 유리한 상황임을 알게되었다면 역으로 반대 방향 간선을 이용하여 기존의 유량을 감소시키는 것도 가능하다.  


#### 경로 찾기
위의 알고리즘에서 경로를 찾는 간단한 방법중 하나는 깊이 우선 탐색이지만 최악의 경우에는 알고리즘이 느려질 수도 있다.  

**에드몬드 카프 알고리즘(Edmonds-Karp algorithm)**은 경로를 이루는 간선의 개수가 최소가 되도록 경로를 선택하는데, 너비 우선 탐색을 이용하면 찾을 수 있다.  
이 경우 유량이 빠르게 증가하는 것을 증명할 수 있으며 시간 복잡도는 `O(m^2n)`이 된다.  

**용량 조절 알고리즘(Capacity scaling algorithm)**은 깊이 우선 탐색을 이용하지만 각 간선의 가중치가 일정 값을 넘어야하는다는 조건이 있다.  
예를 들어 모든 간선의 가중치 합으로 설정할 수 있는데, 경로를 찾을 수 없으면 기준값을 2로 나눈다. 기준값이 0이된다면 알고리즘을 종료시킨다.  
시간 복잡도는 `O(m^2logc)`로 c는 초기 기준값이다.  

#### 최소 컷
포드-풀커슨 알고리즘으로 최대 유량을 찾았다면 그 결과에서 최소 컷을 바로 찾을 수 있다.  
알고리즘을 수행한 이후 그래프에 대해서 A를 소스에서 가중치가 양수인 간선을 이용하여 갈 수 있는 노드의 집합으로 정의하자.  
최소 컷은 원래 그래프에서 A에 속한 노드에서 A에 속하지 않은 노드로 가는 간선으로 구성된다.  
이 간선들의 합이 최소 컷이며 최대 유량이 된다(?)
> 이해가 되지 않았다. 조금 더 고민 해봐야할 것 같다.  


### 12.3.2 서로소 경로
많은 그래프 문제를 최대 유량 문제로 변경하여 풀 수 있는데 아래의 예제를 살펴보자.  
#### 간선 서로소 경로
소스에서 싱크로가는 간선 서로소 경로의 최대 개수를 찾는 문제이다.  
각 간선이 최대 하나의 경로에만 포함이 될 수 있다는 전제로 문제를 시작하는데 간선 서로소 경로의 최대 개수는 각 간선의 용량이 1인 그래프의 최대 유량과 같다.  
최대 유량을 찾은 뒤에는 소스에서 싱크로 가는 경로를 탐욕법 기반으로 찾으면 쉽게 나온다.  

#### 노드 서로소 경로 
소스, 싱크 노드를 제외한 노드들이 하나의 경로에만 포함 될 수 있다는 전제 조건이 있다.  
각각의 노드를 두개의 노드로 만드는데 첫 번째 노드는 들어오는 간선과 연결, 두 번째 노드는 나가는 간선과 연결하고 첫 번째 노드와 두 번째 노드를 연결한다.  
> 그래서 어떻게 찾냐.. 책을 쓰다 말았어.  

### 12.3.3 최대 매칭
그래프의 최대 매칭은 두 노드의 조합으로 이루어진 최대 크기의 집합이다.  
하나의 조헙을 이루는 두 노드는 간선으로 연결되어 있어야하며 각 노드는 최대 하나의 조합에만 속할 수 있다.  
일반적인 그래프는 알고리즘이 복잡하지만, 이분 그래프에서 찾는 경우에는 쉽게 해결이 가능하다.  
이분 그래프는 전체 노드를 두개의 그룹으로 나눌 수 있으며 모든 간선이 왼쪽 그룹과 오른쪽 그룹을 잇도록 설정할 수 있다.  
이 때, 최대 유량 그래프를 만들기 위해서 양 끝단에 소스와 싱크 노드를 추가하고 full connection을 해준다.  

이 그래프에서 최대 유량을 찾는다면, 원래 그래프의 최대 매칭 크기와 같아진다.  
> 간선의 가중치는 1로 설정하면 된다.  

> 작성중
