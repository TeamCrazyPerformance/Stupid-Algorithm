# 구간질의
- 이 장에서는 배열에 대한 구간 질의를 효율적으로 처리하는 자료 구조를 살펴본다.
- 질의의 예인 <strong>구간 합 질의</strong>와 <strong>구간 최소 질의</strong>를 중점으로 살펴본다.

## 정적 배열에 대한 질의
- 질의 사이에 배열의 원소가 절대로 변하지 않는 경우를 먼저 살펴본다.

### 합 질의
- <strong>누적 합 배열</strong>을 먼저 구해 놓으면 임의 합 질의를 효율적으로 처리할 수 있다.
- 누적 합 배열은 O(n)에 구할 수 있다. 구간 합은 구적 합 배열을 이용한 다음 공식에 의해 O(1)에 구할 수 있다.

> sum(a,b) = sum(0,b) - sum(0,a-1)

#### 고차원에 대한 일반화
- 앞의 아이디어를 통해 고차원에 대한 구간 합을 다음 공식을 통해 구할 수 있다.

> S(A)-S(B)-S(C)+S(D)

### 최소 질의
- <strong>희소 테이블</strong> 알고리즘으로 O(nlogn)안에 전처리를 적용하면, O(1)안에 구간 최소 값을 얻을 수 있다.
- 희소 테이블의 아이디어는 b-a+1의 값이 2의 거듭제곱인 min(a,b)를 사전에 전부 구해두는 것이다.

> min(a,b) = min(min(a,a+w-1),min(a+w,b))

- 이때, b+a-1은 2의 거듭제곱이고, w=(b-a+1)/2이다. 이와 같은 방식으로 모든 값을 다 구하는데에는 O(nlogn)시간이 걸린다.
- 이렇게 전처리를 끝나고 나면 다음 공식에 의해 O(1)안에 모든 구간(a,b)의 최솟값을 구할 수 있다.

> min(a,b) = min(min(a,a+k-1),min(b-k+1,b))

- 이때, k는 b-a+1을 초과하지 않는 가장 큰 2의 거듭제곱 수 이다.

## 트리형 자료구조
- 구간 질의와 배열의 원소 갱신 작업을 로그시간에 수행해주는 트리형 자료구조 두 가지를 살펴본다.

### 이진 인덱스 트리
- 이진 인덱스 트리 또는 펜윅 트리는 누적 합 배열의 동적인 변종으로 볼 수 있다.
- O(logn)시간에 구간 합 질의와 배열의 원소 질의를 지원한다.
- 이진 인덱스 트리는 배열의 인덱스가 1부터 시작한다고 가정한다.

#### 합 질의

> tree[k] = sum(k-p(k)+1,k)

- 이때, p(k)를 k의 약수 중에서 2의 거듭제곱 중 가장 큰 것이라고 정의한다.
- 이렇게 전처리를 끝나며 다음 공식에 의해 O(logn)안에 구간 합을 구할 수 있다.

> sum(a,b) = sum(1,b) - sum(1,a-1)

- 위 공식에 대한 이해는 어렵기 때문에 좀 더 자세히 설명하겠다.
- 구간 [1,k]를 이진 인덱스 트리에 그 합이 저장되어 있는 부분 구간 O(logn) 개로 나눌 수 있다.
- 따라서 sum(1,b)와 sum(1,a-1)을 모두 O(logn)시간에 구할 수 있으므로 전체 시간 복잡도도 O(logn)이다.

#### 갱신

> 갱신... 잘 이해가 가지 않는다.

### 구간 트리
- O(logn)시간에 구간 질의와 배열의 원소 질의를 지원한다.
- 이진 인덱스 트리와 다르게 합 질의, 최소 질의 등등 다양한 질의를 지원한다.
- 구간 트리는 이진 트리의 일종이다.
- 말단 트리는 원래 배열의 원소에 대응되며, 나머지 노드는 구간 질의를 처리하기 위한 정보를 담고 있다.

- 배열의 크기가 2의 거듭제곱이고 인덱스가 0부터 시작한다고 가정한다.
- 2의 거듭제곱이 아니라면 적당한 원소를 몇개 추가한다.


#### 합 질의
- 모든 내부 노드는 길이가 2의 거듭제곱인 배열의 구간에 대응된다.
- 내부 노드에 저장할 값은 그에 대응되는 구간의 합이며 O(logn)개 이다.
- 구간 합을 구하기 위해선, 구간에 대응되는 내부노드 두개(혹은 한개)를 구해서 더한다.
- 내부 노드를 O(logn)에 시간에 구하고, 구간 합에 해당하는 두개의 노드를 구해서 더하는데에 O(logn)이 걸리므로 총 O(logn)이 걸린다.

> 구간 합에 해당하는 두개의 노드를 어떻게 구하지?

#### 갱신
- 해당 원소에서 시작하여 트리의 루트로 향하는 경로를 따라가면서 경로상의 노드 값을 갱신해주면 된다.
- O(logn)의 노드를 갱신해야 하므로 총 O(logn)이 걸린다.

#### 그외 질의
- 구간을 두 부분으로 나누고, 각 부분에 대해 독립적으로 답을 구하고, 이를 효율적으로 조합하는 것이 가능해야 한다.
- 또한, 구간 트리의 구조를 잘 활용하면 이진 탐색과 유사한 방식으로 배열 원소의 위치를 찾아낼 수 있다.
<<<<<<< HEAD

### 고급 기법
- 배열을 이용하는 자료 구조의 단점 중 하나는 원소들의 인덱스로 연속된 정수를 사용한다는 데에 있다.
- 인덱스가 커진다면, <strong>인덱스 압축</strong>기법을 사용하여 메모리를 절약한다.
- 인덱스 압축이란, a<b를 만족한다면 c(a)<c(b)를 만족하도록 인덱스를 치환하는 기법이다.
- 즉, 원래 배열에 대한 구간 [a,b]를 압축된 배열 구간[c(a),c(b)]에 대응시킨다.

#### 구간 단위 갱신
- 구간 단위로 갱신하고 개별 원소의 값을 질의하기 위해 <strong>차이 배열</strong>을 살펴본다.
- 차이 배열이란, 원래 배열에서 연달아 있는 두 원소의 차이 값을 저장하고 있는 배열이다.
- 원래의 배열은 차이 배열의 누적 합 배열이 된다.

- 장점은 원래 배열에 대한 구간 단위 갱신을 처리하기 위해 차이 배열의 원소를 두 개만 수정해도 된다는 데 있다.
- 이진 인덱스 트리나 구간 트리를 이 경우에도 사용할 수 있다.
=======
>>>>>>> ab8b72a8fda0d515f87e539b15bd2c90df10e2b8
